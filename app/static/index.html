<!DOCTYPE html>
<html>
    <head>
        <title>USGS NHD editing prototype</title>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="shortcut icon" href="./favicon.ico">
        
        <!-- Ext resources -->
        <link rel="stylesheet" type="text/css" href="externals/ext/resources/css/ext-all.css">
        <link rel="stylesheet" type="text/css" href="externals/ext/resources/css/xtheme-gray.css">
        <script type="text/javascript" src="externals/ext/adapter/ext/ext-base.js"></script>
        <script type="text/javascript" src="externals/ext/ext-all.js"></script>

        <!-- OpenLayers resources -->
        <link rel="stylesheet" type="text/css" href="externals/openlayers/theme/default/style.css">
        <script type="text/javascript" src="script/OpenLayers.js"></script>

        <!-- GeoExt resources -->
        <link rel="stylesheet" type="text/css" href="externals/geoext/resources/css/popup.css">
        <link rel="stylesheet" type="text/css" href="externals/geoext/resources/css/layerlegend.css">
        <link rel="stylesheet" type="text/css" href="externals/geoext/resources/css/gxtheme-gray.css">
        <script type="text/javascript" src="script/GeoExt.js"></script> 

        <!-- gxp resources -->
        <link rel="stylesheet" type="text/css" href="externals/gxp/src/theme/all.css">
        <script type="text/javascript" src="script/gxp.js"></script> 
        
        <!-- ux resources -->
        <script type="text/javascript" src="script/ux.js"></script>
        
        <!-- proj4js resources -->
        <!--
        <script type="text/javascript" src="externals/proj4js/lib/proj4js-compressed.js"></script>
        -->

        <!-- app resources -->
        <link rel="stylesheet" type="text/css" href="theme/app/style.css">
        <!--[if IE]><link rel="stylesheet" type="text/css" href="theme/app/ie.css"/><![endif]-->        
        <script type="text/javascript" src="script/NHDEdit.js"></script>
        <script type="text/javascript">
            Ext.BLANK_IMAGE_URL = "theme/app/img/blank.gif";
            Ext.USE_NATIVE_JSON = true;
            OpenLayers.ImgPath = "theme/app/img/";
            var app = new NHDEdit({
                mapItems: [{
                    xtype: "gx_zoomslider",
                    vertical: true,
                    height: 100
                }, {
                    xtype: "gxp_scaleoverlay"
                }],
                portalConfig: {
                    layout: "border",
                    region: "center",
                    items: [{
                        id: "centerpanel",
                        xtype: "panel",
                        layout: "fit",
                        region: "center",
                        border: false,
                        items: ["mymap"]
                    }, {
                        id: "westpanel",
                        xtype: "container",
                        layout: "fit",
                        region: "west",
                        width: 200
                    }],
                    bbar: {id: "mybbar"}
                },
                tools: [{
                    ptype: "gxp_layertree",
                    outputConfig: {
                        id: "tree",
                        border: true,
                        tbar: []
                    },
                    outputTarget: "westpanel"
                }, {
                    ptype: "gxp_snappingagent",
                    id: "flowline-snapping",
                    targets: [{
                        source: "local",
                        name: "usgs:nhdflowline",
                        maxResolution: 5,
                        node: true,
                        vertex: false,
                        tolerance: 15 // in pixels - default is 10
                    }]
                }, {
                    ptype: "gxp_featuremanager",
                    id: "nhd-manager",
                    paging: false,
                    autoSetLayer: true,
                    maxFeatures: 1
                }, {
                    ptype: "gxp_addlayers",
                    actionTarget: "tree.tbar"
                }, {
                    ptype: "gxp_removelayer",
                    actionTarget: ["tree.tbar", "tree.contextMenu"]
                }, {
                    ptype: "gxp_layerproperties",
                    actionTarget: ["tree.tbar", "tree.contextMenu"]
                }, {
                    ptype: "gxp_zoomtoextent",
                    actionTarget: {target: "map.tbar", index: 0}
                }, {
                    ptype: "gxp_zoom",
                    actionTarget: {target: "map.tbar", index: 1}
                }, {
                    ptype: "gxp_navigationhistory",
                    actionTarget: {target: "map.tbar", index: 3}
                }, {
                    ptype: "gxp_wmsgetfeatureinfo",
                    toggleGroup: "main",
                    actionTarget: {target: "map.tbar", index: 5}
                }, {
                    ptype: "gxp_featureeditor",
                    featureManager: "nhd-manager",
                    autoLoadFeatures: true,
                    snappingAgent: "flowline-snapping",
                    toggleGroup: "main",
                    actionTarget: {target: "map.tbar", index: 6},
                    tolerance: 6,
                    outputConfig: {
                        xtype: "app_featureeditwizard",
                        width: 310,
                        height: 400,
                        excludeFields: ["OBJECTID","ComID","Permanent_Identifier", "WBAreaComID", "WBArea_Permanent_Identifier"],
                        metadataSource: {
                            url: "/geoserver/wfs?",
                            featureType: "nhdmetadata",
                            featureNS: "http://www.usgs.gov/"
                        }
                    }
                }, {
                    ptype: "gxp_legend",
                    outputConfig: {
                        defaults: {autoScroll: true},
                        width: 300,
                        height: 400
                    },
                    actionTarget: {target: "tree.tbar"}
                }, {
                    ptype: "gxp_googlegeocoder",
                    outputTarget: "search",
                    outputConfig: {
                        emptyText: "Search for a location ...",
                        listEmptyText: "- no matches -"
                    }
                }, {
                    ptype: "app_queue",
                    url: "/geoserver/wfs?",
                    featureType: "nhdexceptions",
                    featureNS: "http://www.usgs.gov/",
                    outputConfig: {
                        title: "Exception queue",
                        width: 400,
                        height: 200
                    },
                    actionTarget: {target: "map.tbar", index: 11}
                }, {
                    ptype: "app_preferences",
                    featureManager: "nhd-manager",
                    actionTarget: {target: "map.tbar", index: 12},
                    outputConfig: {
                        title: "Preferences",
                        width: 400,
                        height: 200
                    } 
                }], 
                sources: {
                    local: {
                        ptype: "gxp_wmscsource",
                        url: "/geoserver/wms",
                        version: "1.1.1"
                    },
                    google: {
                        ptype: "gxp_googlesource"
                    },
                    osm: {
                        ptype: "gxp_osmsource"
                    }
                },  
                map: {
                    id: "mymap",
                    projection: "EPSG:900913",
                    units: "m",
                    maxResolution: 156543.0339,
                    maxExtent: [-20037508, -20037508, 20037508, 20037508],
                    center: [-11746265.687635, 4694206.416048],
                    zoom: 7,
                    tbar: {
                        id: "maptoolbar",
                        items: ['-', {xtype: 'container', id: 'search'}, '->']
                    },
                    controls: [
                        new OpenLayers.Control.Navigation({zoomWheelOptions: {interval: 250}}),
                        new OpenLayers.Control.PanPanel(),
                        new OpenLayers.Control.ZoomPanel(),
                        new OpenLayers.Control.Attribution()
                    ],
                    layers: [{
                        source: "osm",
                        name: "mapnik",
                        group: "background"
                    }, {
                        source: "google",
                        name: "TERRAIN",
                        group: "background",
                        visibility: false
                    }, {
                        source: "google",
                        name: "SATELLITE",
                        group: "background",
                        visibility: false
                    }, {
                        source: "local",
                        name: "usgs:nhdwaterbody"
                    }, {
                        source: "local",
                        name: "usgs:nhdarea"
                    }, {
                        source: "local",
                        name: "usgs:nhdline"
                    }, {
                        source: "local",
                        name: "usgs:nhdflowline"
                    }, {
                        source: "local",
                        name: "usgs:nhdpoint"
                    }]
                }
            });
        </script>
    </head>
    <body></body>
</html>
